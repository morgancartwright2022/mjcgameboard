<!DOCTYPE HTML>

<html>
    <head>
        <title>Messages</title>
    </head>
    <body>
        <h1>Messages</h1>
        <textarea id="messages" rows="10" cols="50">Welcome to the message board!</textarea>
        <br>
        <input type="text" id="messageBox" placeholder="Type a message...">
        <button id="sendButton">Send</button>

        <script>
            window.onload = () => {
                const sendBtn = document.getElementById("sendButton");
                const messages = document.getElementById("messages");
                const msgBox = document.getElementById("messageBox");

                let ws;

                function showMessage(message) {
                    messages.innerHTML += "\n\n" + message;
                }

                function init() {
                    if(ws) {
                        ws.onerror = null;
                        ws.onopen = null;
                        ws.onclose = null;
                        ws.close();
                    }

                    ws = new WebSocket("ws://https://mjcgameboard.herokuapp.com/");
                    ws.onopen = () => console.log("Connection opened");
                    ws.onmessage = (msg) => {
                        showMessage(msg.data);
                    }
                    ws.onclose = () => ws = null;
                }

                sendBtn.onclick = () => {
                    if(!ws) {
                        showMessage("Server: No connection.")
                    }
                    else {
                        ws.send("Anonymous: " + msgBox.value);
                        showMessage("Me: " + msgBox.value);
                        msgBox.value = "";
                    }
                }

                init();
            }
        </script>
    </body>
</html>